= Getting Started with Firecracker on Google Compute Engine

- Setup nested VM as explained at https://cloud.google.com/compute/docs/instances/enable-nested-virtualization-vm-instances
- Login to the nested virtualization-enabled VM: `gcloud compute ssh example-nested-vm`
- Build latest version of Firectl:

  ```
  sudo apt-get -y update
  sudo apt-get -y upgrade
  sudo apt-get install -y git make build-essential
  git clone https://github.com/firecracker-microvm/firectl
  wget https://dl.google.com/go/go1.11.4.linux-amd64.tar.gz
  tar -xvf go1.11.4.linux-amd64.tar.gz
  sudo mv go /usr/local
  export GOROOT=/usr/local/go
  mkdir ~/go
  export GOPATH=~/go
  export PATH=$GOPATH/bin:$GOROOT/bin:$PATH
  ```

- Get Firecracker binary:

  ```
  curl -LOJ https://github.com/firecracker-microvm/firecracker/releases/download/v0.12.0/firecracker-v0.12.0
  chmod +x firecracker-v0.12.0
  sudo mv firecracker-v0.12.0 /usr/local/bin/firecracker
  ```

- Give read/write access to KVM:

  ```
  sudo apt-get install -y acl
  sudo setfacl -m u:${USER}:rw /dev/kvm
  ```

- Download kernel and root filesystem:

  ```
  curl -fsSL -o hello-vmlinux.bin https://s3.amazonaws.com/spec.ccfc.min/img/hello/kernel/hello-vmlinux.bin
  curl -fsSL -o hello-rootfs.ext4 https://s3.amazonaws.com/spec.ccfc.min/img/hello/fsfiles/hello-rootfs.ext4
  ```

- Create microVM:

  ```
  ./firectl \
    --kernel=hello-vmlinux.bin \
    --root-drive=hello-rootfs.ext4 \
    --kernel-opts="console=ttyS0 noapic reboot=k panic=1 pci=off nomodules rw"
  ```
